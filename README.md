# highload-mail.ru

## Содержание

* ### [Тема и целевая аудитория](#1)
* ### [Расчет нагрузки](#2)

## 1. Тема и целевая аудитория <a name="1"></a>

**Mail.ru** — почтовый сервис, с возможностью чтения и отправки (с вложениями) писем.

### MVP

- Регистрация/авторизация
- Отправка/пересылка писем
- Чтение писем
- Прикрепление файлов(изображений, архивов)
- Удаление писем

### Целевая аудитория

- Россия, страны СНГ
- Месячная аудитория 51 млн человек (+6% относительно 2021 года) [^1]
- Дневная аудитория 25 млн пользователей [^2]

## 2. Расчет нагрузки <a name="2"></a>

В Почте Mail.Ru размер почтового ящика не ограничен. При регистрации ящика пользователю дается 10 Гб, затем почтовый ящик увеличивается по мере необходимости [^3]. По опыту давних пользователей можно утверждать, что зачастую и 15 Гб бывает мало, поэтом за средний размер одного почтового ящика примем:

    15 GB

Рассмотрим среднестатистического пользователя, пользующийся почтой 8,1 минут в день. 
Для дальнейших расчетов примем следущее:
1) Средний пользователь отправляет в день 1,75 письма(67% без вложения - ~5KB, 33% c вложением - 500KB) [^4]
2) Средний пользователь получает 10 писем(33% из которых - с вложениями)  
3) Пользователь заходит в почту 8 раз в день (~ на 1 мин)   
4) Письма с вложениями составляют 30%
5) Среднее количество запросов пользователя за время пребывание в сервисе ~40 согласно статистике
6) Пиковая активность ~ в два раза больше дневной нормы (5.8 * 10^6 * 2 = 11 600 000)

Расчитаем общее значение RPS:

      RPS = (5.8 * 10^6 * 40)/(24 * 60 * 60) ~ 2686
      RPS(в контексте загрузки ресурсов) = (5.8 * 10^6 * 500)/(24 * 60 * 60) ~ 30000

### Среднее количество действий пользователя по типам в день (RPS) (согласно MVP)

 - <b>Регистрация/авторизация</b>

Приняв во внимание пункт 3, расчитаем средний RPS для авторизации(сильно не влияет на нагрузку из-за длительного кэширования сессий):

      RPS = (5.8 * 10^6 * 8)/(24 * 60 * 60) ~ 537

- <b>Отправка/пересылка писем</b>

Согласно пунту 1, объем данных 1.75 * 0.67 * 5 KB + 1.75 * 0.33 * 500KB = 295KB:

      RPS = (5.8 * 10^6 * 3)/(24 * 60 * 60) ~ 118

      Трафик: (5.8 * 10^6 * 295)/(24 * 60 * 60)  2013KB ~ 2MB

      Пиковое значение (пункт 6): 11.6 * 10^6 * 295KB ~ 20540 Gbit/sec

- <b>Чтение писем</b>

Согласно пунту 2, объем данных 7 * 5 KB + 3 * 500KB = 1535KB:

      RPS = (5.8 * 10^7)/(24 * 60 * 60) ~ 641

      Трафик: (5.8 * 10^6 * 1535)/(24 * 60 * 60)  ~ 100MB

      Пиковое значение (пункт 6): 3.48 * 10^6 * 1535 ~ 130 000 Gbit/sec

- <b>Прикрепление файлов(изображений, архивов)</b>

В среднем 1.75 * 0.33 отправленное письмо имеет вложение(пункт 1), объем данных 1.75 * 0.33 * 500KB = 288KB, тогда:

      RPS = (5.8 * 10^6)/(24 * 60 * 60) ~ 39

      Трафик: (5.8 * 10^6 * 500)/(24 * 60 * 60) ~ 18.5MB

      Пиковое значение (пункт 6): 3.48 * 10^6 * 500 ~ 23 488 Gbit/sec

- <b>Удаление писем</b>

Спам составляет порядка 45.1% от 
полученных писем(на март 2021г) [^5]. Тогда из пункта 2: 10 * 45.1 / 100 = 4.5 . В среднем пользователи почти никогда не удаляют сообщениями, поэтому данная метрику можно отнести к погрешности. В дополнение к этому у большинства почтовых сервисов существуют алгоритмы 
по автоматической очистке спама.

## Список литературы
[^1]: [Ежемесячная аудитория Почты Mail.ru](https://vk.company/ru/press/releases/11388/)
[^2]: [Обзор Mail.ru Group](https://journal.tinkoff.ru/news/review-mail-ru-group/)
[^3]: [НЕ безлимитный почтовый ящик](https://habr.com/ru/articles/272661/)
[^4]: [How Many Emails Are Sent Per Day In 2023?](https://prosperitymedia.com.au/how-many-emails-are-sent-per-day-in-2021/#:~:text=The%20are%20approximately%205.59%20billion,person%20has%201.75%20email%20accounts)
[^5]: [Monthly share of spam in the total e-mail traffic worldwide](https://www.statista.com/statistics/420391/spam-email-traffic-share/)
